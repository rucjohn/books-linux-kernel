# 中断信号的作用

项名思义，中断信号提供了一种特殊的方式，使处理器转而去运行正常控制流之外的代码。**当一个中断信号达到时，CPU 必须停止它当前正在做的事情，并且切换到一个新的活动。为了做到这一点、就要在内核态堆栈保存程序计数器的当前值（即 eip 和 cs 寄存器的内容），并把与中断类型相关的一个地址放进程序计数器**。

在本章，有些事情会使你想起在前一章描述的上下文切换，这发生在内核用一个进程替换另一个进程时。但是，中断处理与进程切换有一个明显的差异：**由中断或异常处理程序执行的代码不是一个进程**。更确切地说，它是一个内核控制路径，代表中断发生时正在运行的进程执行（参见本章“中断和异常处理程序的嵌套执行”一节）。作为一个内核控制路径，中断处理程序比一个进程要 “轻”（light）（中断的上下文很少，建立或终止中断处理需要的时间很少）。

中断处理是由内核执行的最敏感的任务之一，因为它必须满足下列约束：
- 当内核正打算去完成一些别的事情时，中断随时会到来。因此，内核的目标就是让中断尽可能快地处理完，尽其所能把更多的处理向后推迟。例如，假设一个数据块已到达了网线，当硬件中断内核时，内核只简单地标志数据到来了，让处理器恢复到它以前运行的状态，其余的处理稍后再进行（如把数据移入一个缓冲区，它的接收进程可以在缓冲区找到数据并恢复这个进程的执行）。因此，**内核响应中断后需要进行的操作分为两部分：关键而紧急的部分，内核立即执行；其余推退的部分，内核随后执行**。

&emsp;

- 因为中断随时会到来，所以内核可能正在处理其中的一个中断时，另一个中断（不同类型）又发生了。应该尽可能多地允许这种情况发生，因为这能维持更多的 I/O 设备处于忙状态（参见“中断和异常处理程序的嵌套执行”一节）。因此，中断处理程序必须编写成使相应的内核控制路径能以嵌套的方式执行。当最后一个内核控制路径终止时，内核必须能恢复被中断进程的执行，或者，如果中断信号已导致了重新调度，内核能切换到另外的进程。

&emsp;

- 尽管内核在处理前一个中断时可以接受一个新的中断，但在内核代码中还是存在一些临界区，在临界区中，中断必须被禁止。必须尽可能地限制这样的临界区，因为根据以前的要求，内核，尤其是中断处理程序，应该在大部分时间内以开中断的方式运行。
