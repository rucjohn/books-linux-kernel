### 段描述符

每个段由一个8字节的段描述符（*Segement Descriptor*）表示，它描述了段的特征。段描述符放在全局描述符表（*Global Descriptor Table, GDT*）或局部描述符表（*Local Descriptor Table, LDT*）中。

通常只定义一个 GDT，而每个进程除了存放在 GDT 中的段之外如果还需要创建附加的段，就可以有自己的 LDT。GDT 在主存中的地址和大小存放在 `gdtr` 控制寄存器中，当前正在被使用的 LDT 地址和大小都放在 `ldtr` 控制寄存器中。

有几种不同类型的段以及和它们对应的段描述符。下面列出了 Linux 中被广泛采用的类型：

* *代码段描述符*  
表示这个段描述符代表一个代码段，它可以放在 GDT 或 LDT 中。该描述符置 S 标志为 1（非系统段）。  
&emsp;

* *数据段描述符*  
表示这个段描述符代表一个数据段，它可以放在 GDT 或 LDT 中。该描述符置 S 标志为 1。栈段是通过一般的数据段实现的。  
&emsp;

* *任务状态段描述符（TSSD）*  
表示这个段描述符代表一个任务状态段（Task State Segment, TSS），也就是说这个段用于保存处理器寄存器的内容（参见第三章 “任务状态段” 一节）。它只能出现在 GDT 中。根据相应的进程是否正在 CPU 上运行，其 `Type` 字段的值分别为 11 或 9。这个描述符的 S 标志置为 0。  
&emsp;

* *局部描述符表描述符（LDTD）*  
表示这个段描述符代表一个 LDT 的段，它只出现在 GDT 中。相应的 `Type` 字段的值为 2，S 标志置为 0。下一节说明 80x86 处理器如何决定一个段描述符是存放在 GDT 中还是存放在进程的 LDT 中。  
&emsp;

图 2-3 阐明了段描述符的格式。

![图 2-3：段描述符格式](../static/2_3_1.jpg)

表 2-1 解释了图中各个字段的含义

字段名 | 描述
--- | ---
`Base` | 包含段的首字节的线性地址
`G` | 粒度标志：如果该位清0，则段大小以字节为单位，否则以4096字节的倍数计
`Limit` | 存放段中最后一个内存单元的偏移量，从而决定段的长度。如果 G 被置为 0，则一个段的大小在 1 字节到 1 MB 之间变化；否则，将在 4KB 到 4GB 之间变化
`S` | 系统标志：如果它被清0，则这是一个系统段，存储诸如 LDT 这种关键的数据结构，否则它是一个普通的代码段或数据段
`Type` | 描述了段的类型特征和它的存取权限
`DPL` | 描述符特权级（*Descriptor Privilege Level*）字段：用于限制对这个段的存取。它表示为访问这个段而要求的 CPU 最小的优先级。因此，DPL 设为 0 的段只能当 CPL 为 0 时（即在内核态）才是可访问的，而 DPL 设为 3 的段对任何 CPL 值都是可访问的
`P` | 称为 D 或 B 的标志，取决于是代码段还是数据段。D 或 B 的含义在两种情况下稍微有所区别，但是如果段偏移量的地址是 32 位长，就基本上把它置为 1，如果这个偏移量是 16 位长，它被清 0（更详细的描述参见 Intel 使用手册）
`AVL 标志` | 可以由操作系统使用，但是被 Linux 忽略

