#### 物理地址扩展（PAE）分页机制

处理器所支持的 RAM 容量受连接到地址总线上的地址管脚数限制。早期 Intel 处理器从 80386 到 Pentium 使用 32 位物理地址。从理论上讲，这样的系统上可以安装高达 4GB 的 RAM；而实际上，由于用户进程线性地址空间的需要，内核不能直接对 1GB 以上的 RAM 进行寻址，我们就会在后面 “Linux中的分页” 一节中看到这一点。

然而，大型服务器需要大于 4GB 的 RAM 来同时运行数以千计的进程，近几年这对 Intel 造成了压力，所以必须扩展 32 位 80x86 结构所支持的 RAM 容量。

Intel 通过在它的处理器上把管脚数从 32 增加到 36 已经满足了这些需求。从 Pentium Pro 开始，Intel 所有处理器现在寻址能力达到 $$2^{36} = 64GB$$ 。不过，只有引入 一种新的分页机制把 32 位线性地址转换为 36 位物理地址才能使用所增加的物理地址。

从 Pentium Pro 处理器开始，Intel 引入一种叫做物理地址扩展（*Physical Address Extension，PAE*）的机制。另外一种叫做页大小扩展[Page Size Extension（PSE-36）]的机器在 Pentium III 处理器中引入，但是 Linux 并没有采用这种机制，因而我们在本书中不做进一步讨论。

通过设置 cr4 控制寄存器中的物理地址扩展（PAE）标志激活 PAE。页目录项中的页大小标志 PS 启用大尺寸页（在 PAE 启用时为 2MB）。

Intel 为了支持 PAE 已经改变了分页机制。

- 64GB 的 RAM 被分为 $$2^{24}$$ 个页框，页表项的物理地址字段 从 20 位扩展到 24 位。因为 PAE 页表项必须包含 12 个标志位（在前面 “常规分页” 一节已描述）和 24 个物理地址位，总数之和为36，页表项大小从 32 位变成 64 位增加了一位。结果，一个 4KB 的布病有包含 512 个表项而不是 1024 个表项。  
&emsp;

- 引入一个叫做页目录指针表（Page Directory Point Table，PDPT）的布病有新级另，它由 4 个 64 位表项组成。  
&emsp;

- cr3 控制寄存器包含一个 27 位的页目录指针表（PDPT）基地址字段 。因为 PDPT 存放在 RAM 的前 4GB 中，并在 32 字节（$$2^{5}$$）的倍数上对齐，因此 27 位足以表示这种表的基地址。  
&emsp;

- 当把线性地址映射到 4KB 的页时（页目录项中的 PS 标志清 0），32 位线性地址按下列方式解释：

  - *cr3*  
  指向一个 PDPT  
  &emsp;
  
  - *位31 - 30*  
  指向 PDPT 中 4 个项中的一个  
  &emsp;
  
  - *位29 - 21*  
  指向页目录中 512 个项中的一个  
  &emsp;

  - *位20 - 12*  
  指向页表中 512 个项中的一个  
  &emsp;

  - *位11 - 0*  
  4KB 页中的偏移量  
  &emsp;
