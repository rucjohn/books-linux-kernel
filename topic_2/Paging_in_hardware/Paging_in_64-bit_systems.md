#### 64 位系统中的分页

我们在前面几节已经看到，32 位微处理器普遍采用两级分页。然而两级分页并不适用于采用 64 位系统的计算机。让我们用一种思维实验来解释为什么：

> 80x86 处理器中引入 的第三级分页在 PAE 激活时只是将页目录项和页表项的数目 从 1024 个减少到 512 个。这样就将页表项从 32 位扩大到 64 位，于是它们能够存放物理地址的最高 24 位。

首先假设一个大小为 4KB 的标准页。因为 1KB 覆盖 $$2^{10}$$ 个地址的范围，4KB 覆盖 $$2^{12}$$ 个地址，所以 Offset 字段是 12 位。这样线性地址就剩下 52 位分配给 Table 和 Directory 字段。如果我们现在决定仅仅使用 64 位中的 48 位来寻址（这个限制仍然使用我们自在地拥有 256 TB的寻址空间！），剩下的 `48 - 12 = 36` 将被分配给 Table 和 Directory 字段。如果我们现在决定为两个字段 各预留 18 位，那么每个进程的页目录和页表都含有 $$2^{18}$$ 个项，即超过 256000 个项。

由于这个原因，所有 64 位处理器的硬件分页系统都使用了额外的分页级别。使用的级别数量取决于处理器的类型。表 2-4 总结了一些 Linux 所支持 64 位平台使用的硬件分页系统的主要特征。对于与平台名称相关的硬件的简要描述请驻地网第一章的 “硬件依赖性” 一节。

表 2-4：一些 64 位系统的分页级别
平台名称 | 页大小 | 寻址使用的位数 | 分页级别数 | 线性地址分级
--- | --- | --- | --- | ---
alpha | $$8 KB^{a}$$ | 43 | 3 | 10 + 10 + 10 + 13
ia64 | $$4 KB^{a}$$ | 39 | 3 | 9 + 9 + 9 + 12
ppc64 | 4 KB | 41 | 3 | 10 + 10 + 9 + 12
sh64 | 4 KB | 41 | 3 | 10 + 10 + 9 + 12
x86_64 | 4 KB | 48 | 3 | 9 + 9 + 9 + 9 + 12

稍后我们将会在本章的 “Linux中的分页” 一节看到，Linux 成功地提供了一种能用分页模型，它适合于绝大多数所支持的硬件分页系统。

