## Linux 与其他类 Unix 内核的比较

市场上各种类 Unix 系统在很多重要的方面有所不同，其中有些系统已经有很长的历史，并且显得有点过时。所有商业版本都是 SVR4 和 4.4BSD 的变体，并且都趋向于遵循某些通用标准，诸如 IEEE 的 POSIX（Portable Operating Systems based on Unix 基于 Unix 的可移植操作系统） 和 X/Open 的 CAE（Common Applications Enviroment，公共应用环境）。

现有标准仅仅指定了应用程序编程接口（application programming interface, API），即一个已经定义好的环境（用户程序应当运行在该环境下）。因此，这些标准并没有对内核的内部设计施加任何限制。

为了定义一个通用用户接口，类 Unix 内核通常采用相同的设计思想和特征。在这一点上，Linux 和其他的类 Unix 操作系统是一样的。因此，阅读本书并研读 Linux 内核也有助于你理解其他 Unix 变体。

Linux 内核 2.6 版本的目标是遵循 IEEE POSIX 标准。这意味着在 Linux 系统下，很容易编译和运行目前现有的大多数 Unix 程序，只需少许或根本无需为源代码打补丁。此外，Linux 包括了现代 Unix 操作系统的全部特点，诸如虚拟存储、虚拟文件系统、轻量级进程、Unix 信号量、SVR4 进程间通信、支持对称多处理器（Symmetric Multiprocessor，SMP）系统等。

Linus Torvalds 在写第一个内核的时候，参考了Unix 内幕方面一些经典的书，比如 Maurice Bach 的《The Design of the Unix Operation System》（Prentice Hall, 1986）。实际上，Linux 始终对 Bach 的书（即 SVR2）中所描述的 Unix 基准有些偏爱。但是，Linux 没有拘泥于任何一个特定的变体，相反，它尝试采纳了几种不同 Unix 内核中最好的特征和设计选择。

Linux 与一些著名的商用 Unix 内核到底如何竞争，下面给予描述：

* *单块结构的内核（Monolithic kernel）*  
它是一个庞大、复杂的自我完善（do-it-yourself）程序，由几个逻辑上独立的成分构成。在这一点上，它是相当传统的，大多数商用 Unix 变体也是单块结构。（一个显著的例外是 Apple 的 Mac OS X 和 GNU 的 Hurd 操作系统，它们都是从卡耐基 - 梅隆大学的 Mach 演变而来的，都遵循微内核的方法）。  
&emsp;

* *编译并静态连接的传统 Unix 内核*  
大部分现代操作系统内核可以动态地装载和卸载部分内核代码（典型的例子如设备驱动程序），通常把这部分代码称为模块（Module）。Linux 对模块的支持是很好的，因为它能自动按需装载或卸载模块。在主要的商用 Unix 变体中，只有 SVR4.2 和 solaris 内核有类似的特点。  
&emsp;

* *内核线程*  
一些 Unix 内核，如 Solaris 和 SVR4.2/MP，被组织成一组内核线程（kernel thread）。内核线程是一个能独立调度的执行环境（context）；也许它与用户程序有关，也许仅仅执行一些内核函数。线程之间的上下文切换比普通进程之间的上下文切换花费的代价要少得多，因为前者通常在同一个地址空间执行。Linux 以一种十分有限的方式使用内核线程来周期性执行几个内核函数；但是，它们并不代表基本的执行上下文抽象（这就是下要要讨论的议题）。  
&emsp;

* *多线程应用程序支持*  
大多数现代操作系统在某种程度上都支持多线程应用程序，也就是说，这些用户程序是根据很多相对独立的执行流来设计的，而这些执行流之间共享应用程序的大部分数据结构。一个多线程用户程序由很多轻量级进程（lightweight process, LWP）组成，这些进程可能对共同的地址空间、共同的物理内存页、共同的打开文件等等进行操作。Linux 定义了自己的轻量级进程版本，这与 SVR4、Solaris 等其他操作系统上所使用的类型有所不同。当 LWP 的所有商用 Unix 变体都基于内核线程时，Linux 却把轻量级进程当作基本的执行上下文，通过非标准的 clone() 系统调用来处理它们。  
&emsp;

* *抢占式（preemptive）内核*  
当采用 “可抢占的内核” 选项来编译内核时，Linux 2.6可以随意交错执行处于特权模式的执行流。除了 Linux 2.6，还有其他一些传统的、通用的 Unix 系统（如 Solaris 和 Mach 3.0）是完全的抢占式内核。SVR4.2/MP 通过引入一些固定抢占点（fixed preemption point）的方法获得有限的抢占能力。  
&emsp;

* *多处理器支持*  
几种 Unix 内核变体都利用了多处理器系统。Linux 2.6 支持不同存储模式的对称多处理（SMP），包括 NUMA：系统不仅可以使用多处理器，而且每个处理器可以毫无区别地处理任何一个任务。尽管通过一个单独的 “大内核锁” 使得内核中的少数代码依然串行执行，但公平地说，Linux 2.6 以几乎最优化的方式使用 SMP。  
&emsp;

* *文件系统*  
Linux 标准文件系统呈现出多种风格。如果你没有特殊需要，就可以使用普通的 Ext2 文件系统。如果想避免系统崩溃后冗长的文件系统检查，就可以切换到 Ext3。如果你不得不处理很多小文件，ReiserFS 文件系统可能就是最好的选择。除了 Ext3 和 ReiserFS，还可以在 Linux 中使用另外几个日志文件系统；这些文件系统包括 IBM AIX 的日志文件系统（journaling File System, JFS）和 SGI 公司 IRIX 系统上的 XFS 文件系统。有了强大的面向对象虚拟文件系统技术（为 Solaris 和 SVR4 所采用），把外部文件系统移植到 Linux 比移植到其他内核相对要容易。  
&emsp;

* *STREAMS*  
尽管现在大部分的 Unix 内核内包含了 SVR4 引入的 STREAMS I/O 子系统，并且已变成编写设备驱动程序、终端驱动程序及网络协议的首选接口，但是 Linux 并没有与此类似的子系统。

###

对 Linux 的评价充分说明，与商业化的操作系统相比，Linux 已经具备足够的竞争力。而且，Linux 一些独具特色的特点使其成为一种趣味盎然的操作系统。商业化的 Unix 内核为了赢得更大的市场份额通常也引入了新特征，但这些特征是可有可无，其稳定性和效率都值得商榷。事实上，现代 Unix 内核有向更臃肿变化的倾向，而 Linux 以及其他开放源代码的操作系统不受市场因素的制约，因此可以根据设计者的想法（主要是 Linus Torvalds 的想法）自由演进。尤其是，与商用竞争对手相比，Linux 有如下优势：

* ***Linux 是免费的***。除硬件之外，你无需任何花费就能安装一套完整的 Linux 系统。  
&emsp;

* ***Linux 的所有成分都可以充分地定制***。通过内核编译选项，你可以选择自己真正需要的特征来定制内核。而且有了通用公共许可证（GPL），你就可以自由得阅读、修改内核和所有系统程序的源代码。  
&emsp;

* ***Linux 可以行动在低档、便宜的硬件平台上***。你可以用一个 4MB 内存的 旧 Intel 80386 系统构建网络服务器。  
&emsp;

* ***Linux 是强大的***。由于充分挖掘了硬件部分的特点，使得 Linux 系统速度非常快。Linux 的主要目标是效率，所以，商用系统的许多设计选择由于有降低性能的隐患而被 Linus 舍弃，如 STREAMS I/O 子系统。  
&emsp;

* ***Linux 的开发者都是非常出色的程序员***。Linux 系统非常稳定，有非常低的故障率和非常少系统维护时间。  
&emsp;

* ***Linux 内核非常小，而且紧凑***。我们甚至可以把一个内核映像和一些系统程序放在一张 1.4MB 的软盘上！据我们所知，没有一个商用 Unix 变体能从一个张软盘上启动。  
&emsp;

* ***Linux 与很多通用操作系统高度兼容***。Linux 可以让你直接安装以下文件系统的所有版本：MS-DOS 和 MS Windows、SVR4、OS/2、Mac OS X、Solaris、SunOS、NEXTSTEP，还有很多 BSD 变体等等。另外，Linux 也能对很多网络层进行操作，这些网络层如以太网【如：快速以太网和高速（Gbit/s 以及 10Gbit/s）以太网】、光纤分布式数据接口（Fiber Distributed Data Interfase，FDDI）、高性能并行接口（High Performance Parallel Interface，HIPPI）、IEEE 802.11（无线局域网）和 IEEE 802.15（蓝牙）。通过使用适当的库函数，Linux 系统甚至能直接运行为其他操作系统所编写的程序。例如，Linux 能执行为以下操作系统所编写的应用程序：MS-DOS、MS Windows、SVR3 及 SVR4、4.4 BSD、SCO Unix、Xenix，以及其他在 Intel 80x86 平台上运行的操作系统。  
&emsp;

* ***Linux 有很好的技术支持***。不管你信不信，Linux 比任何有版权的操作系统更容易获得补丁和更新！如果你把遇到的难题发给一些新闻组或邮件列表，经常在几个小时内就会得到回应。此外，当新的硬件产品投放到市场以后，其 Linux 驱动程序通常在几周内就可得到。与此相反，硬件厂商仅仅给少数商业操作系统发布设备驱动程序，通常只有微软一家。因此，所有商用 Unix 变体只能运行在有限的硬件上。  
&emsp;

